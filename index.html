<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home ¬∑ Maine Hindu Temple</title>
  <link rel="stylesheet" href="styles.css" />

  <style>
    /* Logo styling */
    .brand img {
      width: 300px;
      height: auto;
      border-radius: 8px;
      display: block;
    }
    .brand div {
      display: none;
    }

    /* Marquee Visitor Counter Styling */
    #visitor-counter {
      margin-top: 15px;
      width: 100%;
      overflow: hidden;
      background-color: #fff7dc;
      border-radius: 30px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      padding: 8px 0;
      text-align: center;
    }

    .marquee-content {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 1.1rem;
      color: #b89c3d;
      white-space: nowrap;
      animation: marquee 12s linear infinite;
    }

    /* Pause animation when hovered */
    #visitor-counter:hover .marquee-content {
      animation-play-state: paused;
    }

    @keyframes marquee {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }

    #visitor-counter svg {
      width: 20px;
      height: 20px;
      fill: #b89c3d;
    }

    /* Footer visitor counter */
    #footer-counter {
      font-weight: 700;
      color: #b89c3d;
      background-color: #fff7dc;
      border-radius: 25px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      justify-content: center;
      padding: 6px 12px;
      margin-top: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #footer-counter svg {
      width: 16px;
      height: 16px;
      fill: #b89c3d;
    }
  </style>
</head>

<body>

  <!-- Navigation -->
  <nav class="nav">
    <div class="inner container">
      <div class="brand">
        <img src="mht.jpg" alt="MHT Logo">
      </div>
      <div class="menu">
        <a href="index.html" class="active">Home</a>
        <a href="about.html">About</a>
        <a href="events.html">Events</a>
        <a href="gallery.html">Gallery</a>
        <a href="volunteer.html">Volunteer</a>
        <a href="donate.html">Donate</a>
        <a href="contact.html">Contact</a>
        <a href="report.html">Report2025</a>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <header class="hero container">
    <span class="badge">SanƒÅtana Dharma ¬∑ ‡§∏‡§§‡•ç‡§Ø‡§Ç ‡§∂‡§ø‡§µ‡§Ç ‡§∏‡•Å‡§Ç‡§¶‡§∞‡§Æ‡•ç</span>
    <h1>Welcome to Maine Hindu Temple</h1>

    <!-- Scrolling Visitor Counter -->
    <div id="visitor-counter" class="marquee">
      <div class="marquee-content">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2zm0 18a8 8 0 1 1 8-8a8.009 8.009 0 0 1-8 8zm1-13h-2v6l5.25 3.15l1-1.63L13 12.75z"/>
        </svg>
        <strong>You are visitor #<span id="count">0</span> üéâ</strong>
      </div>
    </div>

    <p>MHT is a spiritual and cultural home for the Hindu community in Maine. Join us for weekly puja, festivals, and cultural programs.</p>
    <a class="cta" href="events.html">See Upcoming Events</a>
  </header>

  <!-- Main Content -->
  <main class="container">
    <div class="grid">
      <div class="card">
        <h3>Temple Timings</h3>
        <p>Mon‚ÄìFri: 6‚Äì8 PM ¬∑ Sat‚ÄìSun: 9 AM‚Äì1 PM &amp; 5‚Äì8 PM</p>
        <a class="cta" href="contact.html">Plan Your Visit</a>
      </div>
      <div class="card">
        <h3>Support the Temple</h3>
        <p>Your contributions sustain daily puja, festivals, and community programs.</p>
        <a class="cta" href="donate.html">Donate</a>
      </div>
      <div class="card">
        <h3>Volunteer</h3>
        <p>Help with events, prasadam, operations, and youth activities.</p>
        <a class="cta" href="volunteer.html">Sign Up</a>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <div class="footer container">
    <div><strong>Maine Hindu Temple</strong></div>
    <div>719 Main St, Westbrook, ME 04092 ¬∑ Phone: (207) 370-0475</div>
    <div>¬© <span id="year"></span> Maine Hindu Temple ¬∑ All rights reserved.</div>

    <!-- Footer Visitor Counter -->
    <div id="footer-counter">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2zm0 18a8 8 0 1 1 8-8a8.009 8.009 0 0 1-8 8zm1-13h-2v6l5.25 3.15l1-1.63L13 12.75z"/>
      </svg>
      <strong>Visitor Count: <span id="footer-count">0</span></strong>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // Dynamic year
    document.getElementById('year').textContent = new Date().getFullYear();

    /**
     * Global counter rules:
     * - Only increment if this public IP has never been seen before (global, not just this browser).
     * - We store a "seen" key in a remote KV (CountAPI clone) using a SHA-256 hash of the IP (privacy-friendly).
     * - If seen first time: increment main counter; else: read main counter.
     */

    // --- Config ---
    const COUNTER_BASE = 'https://countapi.mileshilliard.com/api/v1'; // maintained CountAPI clone
    const MAIN_COUNTER_KEY = 'mainehindutemple.net/home'; // global total (change per page if needed)
    const IP_SEEN_PREFIX = 'mht-seen-ip-'; // prefix for per-IP "seen" keys

    // --- Helpers ---
    async function getPublicIP() {
      // Fetch visitor's public IP (simple JSON API)
      const res = await fetch('https://api.ipify.org?format=json', { cache: 'no-store' });
      if (!res.ok) throw new Error('IP fetch failed');
      const data = await res.json();
      return data.ip;
    }

    async function sha256Hex(text) {
      const enc = new TextEncoder();
      const data = enc.encode(text);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const bytes = new Uint8Array(hashBuffer);
      return Array.from(bytes).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    async function countapiHit(key) {
      const url = `${COUNTER_BASE}/hit/${encodeURIComponent(key)}`;
      const res = await fetch(url, { cache: 'no-store' });
      if (!res.ok) throw new Error('hit failed');
      return res.json(); // { value: number }
    }

    async function countapiGet(key) {
      const url = `${COUNTER_BASE}/get/${encodeURIComponent(key)}`;
      const res = await fetch(url, { cache: 'no-store' });
      if (!res.ok) throw new Error('get failed');
      return res.json(); // { value: number }
    }

    function updateUI(total) {
      const n = Number(total || 0);
      document.getElementById('count').textContent = n.toLocaleString();
      document.getElementById('footer-count').textContent = n.toLocaleString();
    }

    (async function initVisitorCount() {
      try {
        // 1) Determine visitor's public IP and hash it (privacy)
        const ip = await getPublicIP();
        const ipHash = await sha256Hex(ip);
        const seenKey = IP_SEEN_PREFIX + ipHash;

        // 2) Mark this IP as seen in the global KV and check the returned value
        //    - If returned value === 1, it's the first time this IP is seen globally -> increment main counter.
        //    - Else, just read the main counter without incrementing.
        let total;
        try {
          const seen = await countapiHit(seenKey); // increments this IP's seen counter
          if (Number(seen.value) === 1) {
            const main = await countapiHit(MAIN_COUNTER_KEY); // first visit from this IP -> increment main
            total = main.value;
          } else {
            const main = await countapiGet(MAIN_COUNTER_KEY); // already seen IP -> just read
            total = main.value;
          }
        } catch (e) {
          // If the "seen" flow fails for any reason, fall back to reading main counter
          const main = await countapiGet(MAIN_COUNTER_KEY);
          total = main.value;
        }

        updateUI(total);
      } catch (err) {
        console.error('Visitor counter failed:', err);
        // Optional: keep 0 or hide the UI if unreachable
        // document.getElementById('visitor-counter').style.display = 'none';
      }
    })();
  </script>

</body>
</html>
